<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="">
  </head>
  <body>
    <!--[if lt IE 7]>
      <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="#">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->
    <div>
      <h1>ToDo List</h1>
      <input id='todo' type='text' />
      <button id='todoBtn'>Add todo</button>
      <ul id='todos'></ul>
    </div>
    <div>
      <h1>Goals</h1>
      <input id='goal' type='text' />
      <button id='goalBtn'>Add Goal</button>
      <ul id='goals'></ul>
    </div>

    <script>
      function createStore(reducer){
        //1. state
        //2. get state
        //3. listen to changes on state
        //4. update state
        let state 
        listeners = []

        const getState = ()=> state


        const subscribe = (listner)=>{
          listeners.push(listner)
          return ()=>{
            listeners = listeners.filter((l)=>l!=listner)
          }
        }

        const dispatch = (action)=>{
          state = reducer(state,action)
          listeners.forEach((l)=>l())
        }

        return {
          getState, subscribe,dispatch
        }
      }

        //Use consts instead of strings
        const ADD_TODO = 'ADD_TODO'
        const REMOVE_TODO = 'REMOVE_TODO'
        const TOGGLE_TODO = 'TOGGLE_TODO'
        const ADD_GOAL = 'ADD_GOAL'
        const REMOVE_GOAL = 'REMOVE_GOAL'

        function addToDoAction(todo){
          return {
            type:ADD_TODO,
            todo
          }
        }

        function removeToDoAction(id){
          return{
            type:REMOVE_TODO,
            id
          }
        }

        function toggleToDoAction(id){
          return{
            type:TOGGLE_TODO,
            id
          }
        }

        function addGoalAction(goal){
          return{
            type:ADD_GOAL,
            goal
          }
        }

        function removeGoalAction(id){
          return{
            type:REMOVE_GOAL,
            id
          }
        }

      function goals (state = [], action) {
        switch(action.type) {
          case 'ADD_GOAL' :
            return state.concat([action.goal])
          case 'REMOVE_GOAL' :
            return state.filter((goal) => goal.id !== action.id)
          default :
            return state
        }
      }

      function todos(state=[], action){
        switch (action.type){
          case 'ADD_TODO':
            return state.concat([action.todo]);
          case 'REMOVE_TODO':
            return state.filter((todo)=>todo.id!==action.id);
          case 'TOGGLE_TODO':
            return state.map((todo)=> todo.id!==action.id ? todo :
            Object.assign({},todo,{complete:!todo.complete}));
          default:
            return state
        }
      }
      

      function app (state = {}, action) {
        return {
          todos: todos(state.todos, action),
          goals: goals(state.goals, action),
        }
      }


      const store = createStore(app)

      store.subscribe(()=>{
        console.log('new state;',store.getState())

      })

      store.dispatch(addToDoAction({
        id:2,
        name: 'Go gym',
        complete:true
      }))

      store.dispatch(removeToDoAction(1))

      store.dispatch(toggleToDoAction(0))

      store.dispatch(addGoalAction({
        id:0,
        name:'learn redux'
      }))

      store.dispatch(addGoalAction({
        id:1,
        name:'lose weight too fat'
      }))

      store.dispatch(removeGoalAction(0))
    </script>
    <script src="" async defer></script>
  </body>
</html>